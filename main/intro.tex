\chapter{Introduction}
\label{chap:intro}

Reactive systems interact with their environment by receiving inputs, corresponding to the state of the environment, and sending outputs, which describe actions of the system. Finite-state reactive systems are often modeled by \emph{transducers} -- finite-state machines over alphabets $\sI$ and $\sO$ of inputs and outputs, respectively, which read an input letter in $\sI$, and respond with an output in $\sO$. 
Such transducers are amenable to automatic verification of certain properties (e.g., LTL model-checking), and are therefore useful in practice. Nonetheless, modeling complex systems may result in huge transducers, which makes verification procedures prohibitively expensive, and makes understanding the constructed transducers difficult.

A common approach to gain a better understanding of a transducer (or more generally, any system) is \emph{simulation}~\cite{Milner1971}, whereby a transducer $\cT_1$ is simulated by a ``simpler'' transducer $\cT_2$ in such a way that model checking is easier on $\cT_2$, and the correctness of the desired property is preserved under the simulation. Usually, ``simpler'' means smaller, as in standard simulation~\cite{Milner1971} and fair simulation~\cite{Henzinger1997}, but one can also view e.g., linearization of concurrent programs~\cite{Herlihy1987} as a form of simulation by a simpler machine.

In this work, we introduce and study new notions of simulation and of equivalence for transducers, based on \emph{rounds}: consider an input word $x\in \sI^*$ whose length is $k\cdot R$ for some $k,R>0$. We divide the word into $R$ disjoint infixes of length $k$, each called a round of $w$. We then say that two words $x,x'\in \sI^{kR}$ are $k$-round equivalent, denoted $x'\req[k]x$, if $x'$ is obtained from $x$ by permuting the letters within each round of $x$. For example $abcabc$ and $cbaacb$ are $3$-round equivalent, since $cba$ is a permutation of $abc$ and so is $acb$. \Cref{example:word-req} presents a pair of words that are 3-round equivalent but not 4-round equivalent. We now say that a transducer $\cT_1$ is \emph{$k$-round simulated} by a transducer $\cT_2$, denoted $\cT_1\prec_{k} \cT_2$, if for every\footnote{Our formal definition allows to also restrict the input to some regular language $\fL\subseteq \sI^*$, see~\cref{chap:round_equivalence}.} input $x\in \sI^{kR}$ we can find $x'\req[k]x$ such that the outputs of $\cT_1$ on $x$ and $\cT_2$ on $x'$, denoted $y,y'$ respectively, are also round equivalent: $y'\req[k] y$.
Intuitively, $\cT_1\prec_{k}\cT_2$ means that every behaviour of $\cT_1$ is captured by $\cT_2$, up to permutations within each round.
When we have both $\cT_1\prec_{k}\cT_2$ and $\cT_2\prec_{k}\cT_1$, we say that they are $k$-round equivalent and denote this by $\cT_1\equiv_{k}\cT_2$.

The benefit of $k$-round simulation is twofold. First, it may serve as an alternative simulation technique for reducing the state space while maintaining the correctness of certain properties. Second, we argue that $k$-round simulation is in and of itself a design concern. Indeed, in certain scenarios, as follows, we can naturally design a transducer $\cT_2$ that performs a certain task in an ideal, but not realistic, way, and we want to check that an existing design, namely $\cT_1$, is simulated by this ideal. In particular, this is useful when dealing with systems that naturally work in rounds, such as schedulers (e.g., Round Robin, cf.~\cref{example:transducer-req}), arbiters, and other resource allocation systems.

We now demonstrate both benefits by an example.
\begin{example}
\label{example:MC_rounds}
Consider a monitor $M$ for the fairness of a distributed system with $10$ processes $\cP=\{1,\ldots,10\}$. At each timestep, $M$ receives as input the ID of the process currently working. The monitor then verifies that in each round of $10$ steps, every process works exactly once. As long as this holds, the monitor keeps outputting $\texttt{safe}$; otherwise, it outputs $\texttt{error}$.

$M$ can be modeled by a transducer $\cT_1$ that keeps track of the set of processes that have worked in the current round. Thus, the transducer has at least $2^{10}$ states, as it needs to keep track of the subset of processes that have been seen.

It is not hard to see that $\cT_1$ is $10$-round simulated by an ``ideal'' transducer $\cT_2$ which expects to see the processes in the order $1,\ldots,10$. This transducer needs roughly $10$ states, as it only needs to know the index of the next process it expects to see.

Now, suppose we want to verify some correctness property which is invariant to permutations of the processes within each round of length 10, such as ``if there is no \texttt{error}, then Process $3$ works at least once every 20 steps''. Then we can verify this against the much smaller $\cT_2$.
\end{example}

The notion of $k$-round simulation arises naturally in the setting of \emph{process symmetry}. There, the input and output alphabets are $\sI=\tI$ and $\sO=\tO$ respectively, where $I=\{i_1,\ldots,i_m\}$ and $O=\{o_1,\ldots,o_m\}$ represent signals corresponding to $m$ processes. Process symmetry addresses the scenario where the identities of the processes may be scrambled. For example, if the input $\{i_1,i_2\}$ is generated, the system might actually receive an input $\{i_7,i_4\}$. A system exhibits process symmetry if, intuitively, its outputs are permuted in a similar way to the inputs. Unfortunately, deterministic systems that are process symmetric are extremely naive, as process symmetry is too restrictive for them. While this can be overcome using probabilistic systems, as studied in~\cite{Almagor2020b}, it is also desirable to find a definition that is suited for deterministic systems. As we show in~\cref{chap:application}, $k$-round simulation provides such a definition.

The main contributions of this work are as follows. We introduce the notion of $k$-round simulation and $k$-round equivalence, and define two decision problems pertaining to them: in \emph{fixed round simulation} we need to decide whether $\cT_1\prec_k \cT_2$ for a given value of $k$, and in \emph{existential round simulation} we need to decide whether there exists some value of $k$ for which $\cT_1\prec_k \cT_2$ holds. In fact, we consider a somewhat more elaborate setting, by also allowing the inputs to $\cT_1$ to be restricted to some regular language $\fL$.
We solve the first problem by reducing it to the containment of two nondeterministic automata. For the second problem, things become considerably more difficult, and the solution requires several constructions, as well as tools such as \glsentrylong{pa} and Parikh's theorem. 
In addition, we demonstrate the usefulness of the definitions in relation to process symmetry.

\subsection*{Related Work}
Simulation relations between systems are a well studied notion. We refer the reader to~\cite[Chapter 13]{Clarke2018a} and references therein for an exposition. The connection of our notion with standard simulation is only up to motivation, as our measure is semantic: it does not directly relate to the state space; instead, it refers to the \emph{behaviour} of the system rather than its structure.

On the technical level, our work is closely related to \emph{commutative automata}~\cite{Brzozowski1973} and \emph{jumping automata}~\cite{Fernau2015,Meduna2012} --- models of automata capable of reading their input in a discontinuous manner, by jumping from one letter to another. Indeed, our notion of round simulation essentially allows the simulating transducer to read the letters within rounds in a discontinuous manner. This similarity is manifested implicitly in~\cref{sec:proof_of_bound}, where we encounter similar structures as e.g. the commutative closure in~\cite{Hoffmann2020} (although the analysis here has a different purpose).

Finally, the initial motivation for this work comes from \emph{process symmetry}~\cite{Almagor2020b,Clarke1996,Emerson1996,Ip1996,Lin2016}. We explore the connections in depth in~\cref{chap:application}.

\subsection*{Thesis Organization}
The rest of this work is organized as follows.
In~\cref{chap:prelims} we present some basic definitions used throughout our research. In~\cref{chap:round_equivalence} we introduce $k$-round simulation and equivalence, define the relevant decision problems, and study some fundamental properties of the definitions. In~\cref{chap:deciding_fixed_round_sim} we solve fixed round simulation, while developing some technical tools and characterizations that are reused later. \cref{chap:deciding_existential_round_sim} is our main technical result, where we develop a solution for existential round simulation. In particular, in~\cref{sec:intuitive_overview} we give an overview of the solution, before going through the technical details in~\cref{sec:proof_of_bound}. In~\cref{sec:lower_bounds_existential} we give lower bounds for the existential setting.
In~\cref{chap:application} we use round simulation to obtain a definition of process symmetry for deterministic transducers, along with an algorithm for deciding it, and in~\cref{chap:equiv_mapping} we go into further detail about the mapping between rounds of transducers within a simulation. Other notions of symmetry and simulation are considered in~\cref{chap:other_notions}, and finally, we discuss these variants and conclude with some open problems in~\cref{chap:discussion}.
